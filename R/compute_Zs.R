compute_Zs = function(data){ # TEs = tibble()TE_var =  matrix(0,2,2)TEs =  tibble(Y = mean(data$Y[data$C_i==1]) - mean(data$Y[data$C_i==0]), S= mean(data$S[data$C_i==1]) - mean(data$S[data$C_i==0])) #Nk = c(data |> filter(C_i == 0) |>summarize(n()) |> pull(), data |> filter(C_i == 1) |> summarize(n()) |> pull())Nk = c(sum(data$C_i ==0), sum(data$C_i ==1))s = data |> group_by(C_i)  |> summarize(R =mean(Y*S),p_ys = mean(Y)* mean(S), Y = var(Y), S = var(S) )s0 = s[1,-1]s1 = s[2,-1]TE_var[1,1] =  s0$Y/Nk[1] + s1$Y/Nk[2]TE_var[2,2] =  s0$S/Nk[1] + s1$S/Nk[2]TE_var[1,2] = TE_var[2,1] = (s0$R - s0$p_ys)/Nk[1]  - (s1$R - s1$p_ys)/Nk[2] #res = c("Z_Y" = TEs$Y/sqrt(TE_var[1,1]), "Z_S" = TEs$S/sqrt(TE_var[2,2]), "cor" = TE_var[1,2]/sqrt(TE_var[1,1]*TE_var[2,2]))res = c("Delta_Y" = TEs$Y,	"Delta_S" = TEs$S,	"Var_Delta_Y" = TE_var[1,1],	"Var_Delta_S" = TE_var[2,2],	"cor_Delta_YS" = TE_var[1,2]/sqrt(TE_var[1,1]*TE_var[2,2]))return(res)}